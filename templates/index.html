<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½é¼“æ£’è¨“ç·´ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* è¨“ç·´æ¨¡å¼é¸æ“‡ */
        .mode-selector {
            text-align: center;
            margin-bottom: 30px;
        }

        .mode-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 15px 30px;
            margin: 0 10px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        /* è¨“ç·´æµç¨‹å€åŸŸ */
        .training-section, .running-section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }

        .training-section.active, .running-section.active {
            display: block;
        }

        .step {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .step h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .step-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .step-status.pending {
            background: #e5e7eb;
            color: #6b7280;
        }

        .step-status.active {
            background: #fbbf24;
            color: white;
        }

        .step-status.completed {
            background: #10b981;
            color: white;
        }

        .instruction {
            background: #fffbeb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #f59e0b;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .btn.danger {
            background: #ef4444;
        }

        .btn.danger:hover {
            background: #dc2626;
        }

        .btn.success {
            background: #10b981;
        }

        .btn.success:hover {
            background: #059669;
        }

        /* è¨“ç·´è¨ˆæ•¸å™¨ */
        .training-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .hand-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #e5e7eb;
        }

        .hand-section.active {
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .hand-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .position-counters {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .counter-box {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .counter-box.active {
            background: #dbeafe;
            border: 2px solid #3b82f6;
        }

        .counter-label {
            font-size: 0.9em;
            color: #64748b;
            margin-bottom: 5px;
        }

        .counter-value {
            font-size: 2em;
            font-weight: bold;
            color: #1e293b;
        }

        .counter-target {
            font-size: 0.8em;
            color: #94a3b8;
        }

        /* é‹è¡Œæ¨¡å¼ */
        .hit-display {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
        }

        .stick-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .stick-card.hitting {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(239, 68, 68, 0.5);
        }

        .stick-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .stick-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #1e293b;
        }

        .hit-indicator {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .hit-indicator.idle {
            background: #e5e7eb;
            color: #6b7280;
        }

        .hit-indicator.hitting {
            background: #ef4444;
            color: white;
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .position-display {
            text-align: center;
            padding: 30px;
            margin: 20px 0;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 10px;
        }

        .position-label {
            font-size: 1em;
            color: #64748b;
            margin-bottom: 10px;
        }

        .position-value {
            font-size: 3em;
            font-weight: bold;
            color: #0ea5e9;
        }

        .position-value.left { color: #f59e0b; }
        .position-value.center { color: #10b981; }
        .position-value.right { color: #3b82f6; }

        .sensor-data {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .data-box {
            background: #f8fafc;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .data-label {
            font-size: 0.8em;
            color: #64748b;
        }

        .data-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #1e293b;
        }

        .status-bar {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .status-bar.initializing { background: #fbbf24; color: white; }
        .status-bar.ready { background: #3b82f6; color: white; }
        .status-bar.training { background: #f59e0b; color: white; }
        .status-bar.running { background: #10b981; color: white; }

        @media (max-width: 768px) {
            .training-grid, .hit-display {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ æ™ºèƒ½é¼“æ£’è¨“ç·´ç³»çµ±</h1>

        <!-- æ¨¡å¼é¸æ“‡ -->
        <div class="mode-selector">
            <button class="mode-btn active" id="training-mode-btn" onclick="switchMode('training')">
                ğŸ“š è¨“ç·´æ¨¡å¼
            </button>
            <button class="mode-btn" id="running-mode-btn" onclick="switchMode('running')">
                ğŸ® é‹è¡Œæ¨¡å¼
            </button>
        </div>

        <!-- è¨“ç·´æ¨¡å¼ -->
        <div class="training-section active" id="training-section">
            <!-- æ­¥é©Ÿ 1: æ ¡æ­£é å‚™ä½ç½® -->
            <div class="step">
                <h2>æ­¥é©Ÿ 1ï¼šæ ¡æ­£é å‚™ä½ç½® <span class="step-status pending" id="step1-status">å¾…é€²è¡Œ</span></h2>
                <div class="instruction">
                    <strong>ğŸ“ è«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿæ“ä½œï¼š</strong>
                    <ol style="margin: 10px 0 10px 20px;">
                        <li>é›™æ‰‹æ¡å¥½é¼“æ£’</li>
                        <li>å°‡é¼“æ£’ä¿æŒæ°´å¹³å§¿å‹¢</li>
                        <li>å·¦æ‰‹é¼“æ£’æ”¾åœ¨èº«é«”å·¦å´ï¼Œå³æ‰‹é¼“æ£’æ”¾åœ¨èº«é«”å³å´</li>
                        <li>ä¿æŒå§¿å‹¢éœæ­¢ 1 ç§’</li>
                        <li>é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹æ ¡æ­£</li>
                    </ol>
                </div>
                <button class="btn" id="calibrate-btn" onclick="calibrateReadyPosition()">
                    ğŸ¯ é–‹å§‹æ ¡æ­£é å‚™ä½ç½®
                </button>
            </div>

            <!-- æ­¥é©Ÿ 2: è¨“ç·´æ‰“æ“Š -->
            <div class="step">
                <h2>æ­¥é©Ÿ 2ï¼šè¨“ç·´æ‰“æ“Šå‹•ä½œ <span class="step-status pending" id="step2-status">å¾…é€²è¡Œ</span></h2>
                <div class="instruction">
                    <strong>ğŸ¯ è¨“ç·´èªªæ˜ï¼š</strong>
                    <ol style="margin: 10px 0 10px 20px;">
                        <li>ä¾åºè¨“ç·´å·¦æ‰‹å’Œå³æ‰‹</li>
                        <li>æ¯éš»æ‰‹éœ€è¦æ‰“æ“Šä¸‰å€‹ä½ç½®ï¼šå·¦å´ã€ä¸­é–“ã€å³å´</li>
                        <li>æ¯å€‹ä½ç½®éœ€è¦æ‰“æ“Š 20 æ¬¡</li>
                        <li>é¼“æ£’å¿…é ˆå¾€ä¸‹æ®æ‰ç®—æœ‰æ•ˆæ“Šæ‰“</li>
                        <li>é»æ“Šå°æ‡‰æŒ‰éˆ•è¨˜éŒ„æ¯æ¬¡æ‰“æ“Š</li>
                    </ol>
                </div>

                <div class="training-grid">
                    <!-- å·¦æ‰‹è¨“ç·´ -->
                    <div class="hand-section" id="left-hand-section">
                        <div class="hand-title">ğŸ‘ˆ å·¦æ‰‹é¼“æ£’è¨“ç·´</div>
                        <div class="position-counters">
                            <div class="counter-box" id="left-left-box">
                                <div class="counter-label">å·¦å´</div>
                                <div class="counter-value" id="left-left-count">0</div>
                                <div class="counter-target">/ 20</div>
                                <button class="btn" onclick="recordHit('left', 'left')" id="left-left-btn">è¨˜éŒ„</button>
                            </div>
                            <div class="counter-box" id="left-center-box">
                                <div class="counter-label">ä¸­é–“</div>
                                <div class="counter-value" id="left-center-count">0</div>
                                <div class="counter-target">/ 20</div>
                                <button class="btn" onclick="recordHit('left', 'center')" id="left-center-btn">è¨˜éŒ„</button>
                            </div>
                            <div class="counter-box" id="left-right-box">
                                <div class="counter-label">å³å´</div>
                                <div class="counter-value" id="left-right-count">0</div>
                                <div class="counter-target">/ 20</div>
                                <button class="btn" onclick="recordHit('left', 'right')" id="left-right-btn">è¨˜éŒ„</button>
                            </div>
                        </div>
                    </div>

                    <!-- å³æ‰‹è¨“ç·´ -->
                    <div class="hand-section" id="right-hand-section">
                        <div class="hand-title">ğŸ‘‰ å³æ‰‹é¼“æ£’è¨“ç·´</div>
                        <div class="position-counters">
                            <div class="counter-box" id="right-left-box">
                                <div class="counter-label">å·¦å´</div>
                                <div class="counter-value" id="right-left-count">0</div>
                                <div class="counter-target">/ 20</div>
                                <button class="btn" onclick="recordHit('right', 'left')" id="right-left-btn">è¨˜éŒ„</button>
                            </div>
                            <div class="counter-box" id="right-center-box">
                                <div class="counter-label">ä¸­é–“</div>
                                <div class="counter-value" id="right-center-count">0</div>
                                <div class="counter-target">/ 20</div>
                                <button class="btn" onclick="recordHit('right', 'center')" id="right-center-btn">è¨˜éŒ„</button>
                            </div>
                            <div class="counter-box" id="right-right-box">
                                <div class="counter-label">å³å´</div>
                                <div class="counter-value" id="right-right-count">0</div>
                                <div class="counter-target">/ 20</div>
                                <button class="btn" onclick="recordHit('right', 'right')" id="right-right-btn">è¨˜éŒ„</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn success" id="finish-training-btn" onclick="finishTraining()" disabled>
                        âœ… å®Œæˆè¨“ç·´
                    </button>
                    <button class="btn danger" onclick="resetTraining()">
                        ğŸ”„ é‡ç½®è¨“ç·´æ•¸æ“š
                    </button>
                </div>
            </div>
        </div>

        <!-- é‹è¡Œæ¨¡å¼ -->
        <div class="running-section" id="running-section">
            <div class="hit-display">
                <!-- å·¦æ‰‹é¼“æ£’ -->
                <div class="stick-card" id="left-card">
                    <div class="stick-header">
                        <div class="stick-title">ğŸ‘ˆ å·¦æ‰‹é¼“æ£’</div>
                        <div class="hit-indicator idle" id="left-hit-indicator">å¾…æ©Ÿä¸­</div>
                    </div>

                    <div class="position-display">
                        <div class="position-label">æ‰“æ“Šä½ç½®</div>
                        <div class="position-value" id="left-position">---</div>
                    </div>

                    <div class="sensor-data">
                        <div class="data-box">
                            <div class="data-label">åŠ é€Ÿåº¦</div>
                            <div class="data-value" id="left-magnitude">0.00</div>
                        </div>
                        <div class="data-box">
                            <div class="data-label">ä¿¯ä»°è§’</div>
                            <div class="data-value" id="left-pitch">0Â°</div>
                        </div>
                        <div class="data-box">
                            <div class="data-label">ç¿»æ»¾è§’</div>
                            <div class="data-value" id="left-roll">0Â°</div>
                        </div>
                    </div>
                </div>

                <!-- å³æ‰‹é¼“æ£’ -->
                <div class="stick-card" id="right-card">
                    <div class="stick-header">
                        <div class="stick-title">ğŸ‘‰ å³æ‰‹é¼“æ£’</div>
                        <div class="hit-indicator idle" id="right-hit-indicator">å¾…æ©Ÿä¸­</div>
                    </div>

                    <div class="position-display">
                        <div class="position-label">æ‰“æ“Šä½ç½®</div>
                        <div class="position-value" id="right-position">---</div>
                    </div>

                    <div class="sensor-data">
                        <div class="data-box">
                            <div class="data-label">åŠ é€Ÿåº¦</div>
                            <div class="data-value" id="right-magnitude">0.00</div>
                        </div>
                        <div class="data-box">
                            <div class="data-label">ä¿¯ä»°è§’</div>
                            <div class="data-value" id="right-pitch">0Â°</div>
                        </div>
                        <div class="data-box">
                            <div class="data-label">ç¿»æ»¾è§’</div>
                            <div class="data-value" id="right-roll">0Â°</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-bar initializing" id="status-bar">â³ ç³»çµ±åˆå§‹åŒ–ä¸­...</div>
    </div>

    <script>
        let trainingCounts = {
            left: { left: 0, center: 0, right: 0 },
            right: { left: 0, center: 0, right: 0 }
        };

        const TARGET_COUNT = 20;
        let isCalibrated = false;
        let isTrained = false;

        // åˆ‡æ›æ¨¡å¼
        function switchMode(mode) {
            if (mode === 'training') {
                document.getElementById('training-section').classList.add('active');
                document.getElementById('running-section').classList.remove('active');
                document.getElementById('training-mode-btn').classList.add('active');
                document.getElementById('running-mode-btn').classList.remove('active');
            } else {
                if (!isTrained) {
                    alert('è«‹å…ˆå®Œæˆè¨“ç·´ï¼');
                    return;
                }
                document.getElementById('training-section').classList.remove('active');
                document.getElementById('running-section').classList.add('active');
                document.getElementById('training-mode-btn').classList.remove('active');
                document.getElementById('running-mode-btn').classList.add('active');
            }
        }

        // æ ¡æ­£é å‚™ä½ç½®
        function calibrateReadyPosition() {
            if (!confirm('è«‹ç¢ºèªæ‚¨å·²å°‡é›™æ‰‹é¼“æ£’æ“ºæ”¾åœ¨é å‚™ä½ç½®ï¼ˆæ°´å¹³ã€å·¦å³åˆ†é–‹ï¼‰ï¼Œç„¶å¾ŒæŒ‰ç¢ºå®šé–‹å§‹æ ¡æ­£ã€‚')) {
                return;
            }

            document.getElementById('step1-status').textContent = 'æ ¡æ­£ä¸­...';
            document.getElementById('step1-status').className = 'step-status active';
            document.getElementById('calibrate-btn').disabled = true;

            fetch('/api/calibrate_ready_position', { method: 'POST' })
                .then(response => response.json())
                .then(result => {
                    if (result.status === 'success') {
                        document.getElementById('step1-status').textContent = 'å·²å®Œæˆ';
                        document.getElementById('step1-status').className = 'step-status completed';
                        document.getElementById('step2-status').textContent = 'é€²è¡Œä¸­';
                        document.getElementById('step2-status').className = 'step-status active';
                        isCalibrated = true;
                        alert('âœ“ é å‚™ä½ç½®æ ¡æ­£å®Œæˆï¼ç¾åœ¨å¯ä»¥é–‹å§‹è¨“ç·´æ‰“æ“Šå‹•ä½œã€‚');
                        enableTrainingButtons();
                    } else {
                        alert('âœ— æ ¡æ­£å¤±æ•—: ' + result.message);
                        document.getElementById('calibrate-btn').disabled = false;
                        document.getElementById('step1-status').textContent = 'å¾…é€²è¡Œ';
                        document.getElementById('step1-status').className = 'step-status pending';
                    }
                })
                .catch(error => {
                    alert('âœ— è«‹æ±‚å¤±æ•—: ' + error);
                    document.getElementById('calibrate-btn').disabled = false;
                    document.getElementById('step1-status').textContent = 'å¾…é€²è¡Œ';
                    document.getElementById('step1-status').className = 'step-status pending';
                });
        }

        // å•Ÿç”¨è¨“ç·´æŒ‰éˆ•
        function enableTrainingButtons() {
            const buttons = document.querySelectorAll('.counter-box button');
            buttons.forEach(btn => btn.disabled = false);
        }

        // è¨˜éŒ„æ‰“æ“Š
        function recordHit(hand, position) {
            fetch('/api/record_training_hit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ hand, position })
            })
            .then(response => response.json())
            .then(result => {
                if (result.status === 'success') {
                    trainingCounts[hand][position] = result.count;
                    updateCountDisplay(hand, position, result.count);

                    // æª¢æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰è¨“ç·´
                    checkTrainingComplete();
                } else {
                    alert('âœ— è¨˜éŒ„å¤±æ•—: ' + result.message);
                }
            })
            .catch(error => {
                alert('âœ— è«‹æ±‚å¤±æ•—: ' + error);
            });
        }

        // æ›´æ–°è¨ˆæ•¸é¡¯ç¤º
        function updateCountDisplay(hand, position, count) {
            const countEl = document.getElementById(`${hand}-${position}-count`);
            const boxEl = document.getElementById(`${hand}-${position}-box`);
            const btnEl = document.getElementById(`${hand}-${position}-btn`);

            countEl.textContent = count;

            if (count >= TARGET_COUNT) {
                boxEl.style.background = '#d1fae5';
                btnEl.disabled = true;
                btnEl.textContent = 'âœ“ å®Œæˆ';
            }
        }

        // æª¢æŸ¥è¨“ç·´æ˜¯å¦å®Œæˆ
        function checkTrainingComplete() {
            let allComplete = true;

            for (let hand of ['left', 'right']) {
                for (let position of ['left', 'center', 'right']) {
                    if (trainingCounts[hand][position] < TARGET_COUNT) {
                        allComplete = false;
                    }
                }
            }

            document.getElementById('finish-training-btn').disabled = !allComplete;

            if (allComplete) {
                alert('ğŸ‰ æ‰€æœ‰è¨“ç·´æ•¸æ“šå·²æ”¶é›†å®Œæˆï¼è«‹é»æ“Šã€Œå®Œæˆè¨“ç·´ã€æŒ‰éˆ•é€²è¡Œåˆ†æã€‚');
            }
        }

        // å®Œæˆè¨“ç·´
        function finishTraining() {
            if (!confirm('ç¢ºå®šè¦å®Œæˆè¨“ç·´ä¸¦é–‹å§‹åˆ†ææ•¸æ“šå—ï¼Ÿ')) {
                return;
            }

            fetch('/api/finish_training', { method: 'POST' })
                .then(response => response.json())
                .then(result => {
                    if (result.status === 'success') {
                        isTrained = true;
                        document.getElementById('step2-status').textContent = 'å·²å®Œæˆ';
                        document.getElementById('step2-status').className = 'step-status completed';
                        alert('âœ“ ' + result.message + '\n\nç¾åœ¨å¯ä»¥åˆ‡æ›åˆ°ã€Œé‹è¡Œæ¨¡å¼ã€é–‹å§‹ä½¿ç”¨ï¼');
                        switchMode('running');
                    } else {
                        alert('âœ— è¨“ç·´å¤±æ•—: ' + result.message);
                    }
                })
                .catch(error => {
                    alert('âœ— è«‹æ±‚å¤±æ•—: ' + error);
                });
        }

        // é‡ç½®è¨“ç·´
        function resetTraining() {
            if (!confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è¨“ç·´æ•¸æ“šå—ï¼Ÿé€™å°‡æ¸…é™¤æ‰€æœ‰å·²è¨˜éŒ„çš„æ‰“æ“Šæ•¸æ“šã€‚')) {
                return;
            }

            fetch('/api/reset_training', { method: 'POST' })
                .then(response => response.json())
                .then(result => {
                    if (result.status === 'success') {
                        // é‡ç½®è¨ˆæ•¸
                        trainingCounts = {
                            left: { left: 0, center: 0, right: 0 },
                            right: { left: 0, center: 0, right: 0 }
                        };

                        // é‡ç½®é¡¯ç¤º
                        for (let hand of ['left', 'right']) {
                            for (let position of ['left', 'center', 'right']) {
                                updateCountDisplay(hand, position, 0);
                                document.getElementById(`${hand}-${position}-box`).style.background = '#f1f5f9';
                                document.getElementById(`${hand}-${position}-btn`).disabled = !isCalibrated;
                                document.getElementById(`${hand}-${position}-btn`).textContent = 'è¨˜éŒ„';
                            }
                        }

                        document.getElementById('finish-training-btn').disabled = true;
                        isTrained = false;

                        alert('âœ“ è¨“ç·´æ•¸æ“šå·²é‡ç½®ï¼');
                    }
                })
                .catch(error => {
                    alert('âœ— è«‹æ±‚å¤±æ•—: ' + error);
                });
        }

        // æ›´æ–°é‹è¡Œæ¨¡å¼é¡¯ç¤º
        function updateRunningMode(data) {
            updateStickDisplay('left', data.left);
            updateStickDisplay('right', data.right);
        }

        function updateStickDisplay(side, stickData) {
            // æ›´æ–°æ‰“æ“ŠæŒ‡ç¤ºå™¨
            const indicator = document.getElementById(`${side}-hit-indicator`);
            const card = document.getElementById(`${side}-card`);

            if (stickData.is_hitting) {
                indicator.textContent = 'ğŸ’¥ æ‰“æ“Šä¸­';
                indicator.className = 'hit-indicator hitting';
                card.classList.add('hitting');
            } else {
                indicator.textContent = 'å¾…æ©Ÿä¸­';
                indicator.className = 'hit-indicator idle';
                card.classList.remove('hitting');
            }

            // æ›´æ–°ä½ç½®é¡¯ç¤º
            const positionEl = document.getElementById(`${side}-position`);
            if (stickData.hit_position) {
                const positionText = {
                    'left': 'å·¦å´',
                    'center': 'ä¸­é–“',
                    'right': 'å³å´'
                };
                positionEl.textContent = positionText[stickData.hit_position];
                positionEl.className = `position-value ${stickData.hit_position}`;
            } else {
                positionEl.textContent = '---';
                positionEl.className = 'position-value';
            }

            // æ›´æ–°æ„Ÿæ¸¬å™¨æ•¸æ“š
            document.getElementById(`${side}-magnitude`).textContent = stickData.magnitude.toFixed(2);
            document.getElementById(`${side}-pitch`).textContent = stickData.angle.pitch.toFixed(1) + 'Â°';
            document.getElementById(`${side}-roll`).textContent = stickData.angle.roll.toFixed(1) + 'Â°';
        }

        // æ›´æ–°ç‹€æ…‹æ¬„
        function updateStatusBar(status) {
            const statusBar = document.getElementById('status-bar');
            const statusConfig = {
                'initializing': { text: 'â³ ç³»çµ±åˆå§‹åŒ–ä¸­...', class: 'initializing' },
                'ready': { text: 'ğŸŸ¢ ç³»çµ±å°±ç·’ - è«‹é–‹å§‹è¨“ç·´', class: 'ready' },
                'training': { text: 'ğŸŸ¡ è¨“ç·´æ¨¡å¼', class: 'training' },
                'running': { text: 'ğŸŸ¢ é‹è¡Œä¸­ - ç³»çµ±å·²å°±ç·’', class: 'running' }
            };

            const config = statusConfig[status] || statusConfig['initializing'];
            statusBar.textContent = config.text;
            statusBar.className = `status-bar ${config.class}`;
        }

        // å®šæ™‚ç²å–æ•¸æ“š
        function fetchData() {
            fetch('/api/data')
                .then(response => response.json())
                .then(data => {
                    updateStatusBar(data.system_status);

                    if (data.training_status) {
                        isTrained = true;
                    }

                    if (data.calibration_status) {
                        isCalibrated = true;
                    }

                    // å¦‚æœåœ¨é‹è¡Œæ¨¡å¼ï¼Œæ›´æ–°é¡¯ç¤º
                    if (document.getElementById('running-section').classList.contains('active')) {
                        updateRunningMode(data);
                    }
                })
                .catch(error => {
                    console.error('éŒ¯èª¤:', error);
                });
        }

        // æ¯ 50ms æ›´æ–°ä¸€æ¬¡
        setInterval(fetchData, 50);

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        fetchData();

        // ç¦ç”¨æ‰€æœ‰è¨“ç·´æŒ‰éˆ•ç›´åˆ°æ ¡æ­£å®Œæˆ
        const trainingButtons = document.querySelectorAll('.counter-box button');
        trainingButtons.forEach(btn => btn.disabled = true);
    </script>
</body>
</html>
