<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›™é¼“æ£’å³æ™‚ç›£æ§ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .timestamp {
            text-align: center;
            color: rgba(255,255,255,0.9);
            margin-bottom: 30px;
            font-size: 1.2em;
        }

        .drum-sticks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));
            gap: 30px;
            margin-bottom: 20px;
        }

        .stick-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        .stick-card.hitting {
            transform: scale(1.02);
            box-shadow: 0 15px 40px rgba(255,0,0,0.5);
        }

        .stick-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .stick-info {
            display: flex;
            align-items: center;
        }

        .stick-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .stick-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .stick-address {
            font-size: 0.9em;
            color: #666;
            margin-left: 10px;
        }

        .hit-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .hit-indicator.inactive {
            background: #e5e7eb;
            color: #6b7280;
        }

        .hit-indicator.active {
            background: #ef4444;
            color: white;
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .data-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: "â–¶";
            margin-right: 8px;
        }

        .data-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .data-grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .data-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .data-item.highlight {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }

        .data-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .data-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            font-family: 'Courier New', monospace;
        }

        .data-value.large {
            font-size: 2.2em;
        }

        .data-unit {
            font-size: 0.8em;
            color: #888;
            margin-left: 3px;
        }

        .status {
            text-align: center;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 1.1em;
        }

        .status.connected {
            background: #10b981;
        }

        .status.disconnected {
            background: #ef4444;
        }

        .status.calibrating {
            background: #f59e0b;
        }

        .right-stick {
            border-top: 5px solid #3b82f6;
        }

        .left-stick {
            border-top: 5px solid #ec4899;
        }

        .calibrate-btn {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            margin: 10px auto;
            display: block;
            transition: background 0.3s;
        }

        .calibrate-btn:hover {
            background: #7c3aed;
        }

        .calibrate-btn:active {
            transform: scale(0.95);
        }

        @media (max-width: 768px) {
            .drum-sticks {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .data-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ é›™é¼“æ£’å³æ™‚ç›£æ§ç³»çµ±</h1>
        <div class="timestamp">â° æ™‚é–“ï¼š<span id="timestamp">è¼‰å…¥ä¸­...</span></div>

        <button class="calibrate-btn" onclick="recalibrate()">ğŸ¯ é‡æ–°æ ¡æ­£</button>

        <div class="drum-sticks">
            <!-- å·¦æ‰‹é¼“æ£’ -->
            <div class="stick-card left-stick" id="left-card">
                <div class="stick-header">
                    <div class="stick-info">
                        <div class="stick-icon">ğŸ‘ˆ</div>
                        <div>
                            <div class="stick-title">å·¦æ‰‹é¼“æ£’</div>
                            <div class="stick-address">0x69</div>
                        </div>
                    </div>
                    <div class="hit-indicator inactive" id="left-hit">å¾…æ©Ÿä¸­</div>
                </div>

                <!-- å§¿æ…‹è§’åº¦ -->
                <div class="data-section">
                    <div class="section-title">ğŸ“ é¼“æ£’å§¿æ…‹</div>
                    <div class="data-grid-2">
                        <div class="data-item highlight">
                            <div class="data-label">ä¿¯ä»°è§’ (Pitch)</div>
                            <div class="data-value large" id="left-pitch">0Â°</div>
                        </div>
                        <div class="data-item highlight">
                            <div class="data-label">ç¿»æ»¾è§’ (Roll)</div>
                            <div class="data-value large" id="left-roll">0Â°</div>
                        </div>
                    </div>
                </div>

                <!-- åŠ é€Ÿåº¦ -->
                <div class="data-section">
                    <div class="section-title">åŠ é€Ÿåº¦ (g)</div>
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">X è»¸</div>
                            <div class="data-value" id="left-acc-x">0.000</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Y è»¸</div>
                            <div class="data-value" id="left-acc-y">0.000</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Z è»¸</div>
                            <div class="data-value" id="left-acc-z">0.000</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; text-align: center;">
                        <div class="data-item" style="display: inline-block; min-width: 150px;">
                            <div class="data-label">ç¸½åŠ é€Ÿåº¦</div>
                            <div class="data-value" id="left-magnitude">0.00</div>
                        </div>
                    </div>
                </div>

                <!-- é™€èºå„€ -->
                <div class="data-section">
                    <div class="section-title">é™€èºå„€ (Â°/s)</div>
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">X è»¸</div>
                            <div class="data-value" id="left-gyro-x">0.00</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Y è»¸</div>
                            <div class="data-value" id="left-gyro-y">0.00</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Z è»¸</div>
                            <div class="data-value" id="left-gyro-z">0.00</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³æ‰‹é¼“æ£’ -->
            <div class="stick-card right-stick" id="right-card">
                <div class="stick-header">
                    <div class="stick-info">
                        <div class="stick-icon">ğŸ‘‰</div>
                        <div>
                            <div class="stick-title">å³æ‰‹é¼“æ£’</div>
                            <div class="stick-address">0x68</div>
                        </div>
                    </div>
                    <div class="hit-indicator inactive" id="right-hit">å¾…æ©Ÿä¸­</div>
                </div>

                <!-- å§¿æ…‹è§’åº¦ -->
                <div class="data-section">
                    <div class="section-title">ğŸ“ é¼“æ£’å§¿æ…‹</div>
                    <div class="data-grid-2">
                        <div class="data-item highlight">
                            <div class="data-label">ä¿¯ä»°è§’ (Pitch)</div>
                            <div class="data-value large" id="right-pitch">0Â°</div>
                        </div>
                        <div class="data-item highlight">
                            <div class="data-label">ç¿»æ»¾è§’ (Roll)</div>
                            <div class="data-value large" id="right-roll">0Â°</div>
                        </div>
                    </div>
                </div>

                <!-- åŠ é€Ÿåº¦ -->
                <div class="data-section">
                    <div class="section-title">åŠ é€Ÿåº¦ (g)</div>
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">X è»¸</div>
                            <div class="data-value" id="right-acc-x">0.000</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Y è»¸</div>
                            <div class="data-value" id="right-acc-y">0.000</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Z è»¸</div>
                            <div class="data-value" id="right-acc-z">0.000</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; text-align: center;">
                        <div class="data-item" style="display: inline-block; min-width: 150px;">
                            <div class="data-label">ç¸½åŠ é€Ÿåº¦</div>
                            <div class="data-value" id="right-magnitude">0.00</div>
                        </div>
                    </div>
                </div>

                <!-- é™€èºå„€ -->
                <div class="data-section">
                    <div class="section-title">é™€èºå„€ (Â°/s)</div>
                    <div class="data-grid">
                        <div class="data-item">
                            <div class="data-label">X è»¸</div>
                            <div class="data-value" id="right-gyro-x">0.00</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Y è»¸</div>
                            <div class="data-value" id="right-gyro-y">0.00</div>
                        </div>
                        <div class="data-item">
                            <div class="data-label">Z è»¸</div>
                            <div class="data-value" id="right-gyro-z">0.00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="status connected" id="status">ğŸŸ¢ é€£ç·šä¸­</div>
    </div>

    <script>
        // æ›´æ–°æ•¸æ“šé¡¯ç¤º
        function updateDisplay(data) {
            // æ›´æ–°æ™‚é–“æˆ³
            document.getElementById('timestamp').textContent = data.timestamp;

            // æ›´æ–°å³æ‰‹é¼“æ£’æ•¸æ“š
            updateStickData('right', data.right);

            // æ›´æ–°å·¦æ‰‹é¼“æ£’æ•¸æ“š
            updateStickData('left', data.left);

            // æ›´æ–°ç‹€æ…‹
            const statusEl = document.getElementById('status');
            if (data.is_calibrated) {
                statusEl.textContent = 'ğŸŸ¢ å·²æ ¡æ­£ - ç³»çµ±é‹è¡Œä¸­';
                statusEl.className = 'status connected';
            } else {
                statusEl.textContent = 'ğŸŸ¡ æ ¡æ­£ä¸­...';
                statusEl.className = 'status calibrating';
            }
        }

        function updateStickData(side, data) {
            // æ›´æ–°å§¿æ…‹è§’åº¦
            document.getElementById(`${side}-pitch`).textContent = data.angle.pitch.toFixed(1) + 'Â°';
            document.getElementById(`${side}-roll`).textContent = data.angle.roll.toFixed(1) + 'Â°';

            // æ›´æ–°åŠ é€Ÿåº¦
            document.getElementById(`${side}-acc-x`).textContent = data.accel.x.toFixed(3);
            document.getElementById(`${side}-acc-y`).textContent = data.accel.y.toFixed(3);
            document.getElementById(`${side}-acc-z`).textContent = data.accel.z.toFixed(3);
            document.getElementById(`${side}-magnitude`).textContent = data.magnitude.toFixed(2);

            // æ›´æ–°é™€èºå„€
            document.getElementById(`${side}-gyro-x`).textContent = data.gyro.x.toFixed(2);
            document.getElementById(`${side}-gyro-y`).textContent = data.gyro.y.toFixed(2);
            document.getElementById(`${side}-gyro-z`).textContent = data.gyro.z.toFixed(2);

            // æ›´æ–°æ‰“æ“ŠæŒ‡ç¤ºå™¨
            const hitIndicator = document.getElementById(`${side}-hit`);
            const card = document.getElementById(`${side}-card`);

            if (data.is_hitting) {
                hitIndicator.textContent = 'ğŸ’¥ æ‰“æ“Šï¼';
                hitIndicator.className = 'hit-indicator active';
                card.classList.add('hitting');
            } else {
                hitIndicator.textContent = 'å¾…æ©Ÿä¸­';
                hitIndicator.className = 'hit-indicator inactive';
                card.classList.remove('hitting');
            }
        }

        // é¡¯ç¤ºéŒ¯èª¤ç‹€æ…‹
        function showError() {
            const statusEl = document.getElementById('status');
            statusEl.textContent = 'ğŸ”´ é€£ç·šéŒ¯èª¤';
            statusEl.className = 'status disconnected';
        }

        // é‡æ–°æ ¡æ­£
        function recalibrate() {
            if (confirm('è«‹å°‡å…©æ”¯é¼“æ£’æ”¾åœ¨å¹³ç©©çš„è¡¨é¢ä¸Šï¼Œç„¶å¾ŒæŒ‰ç¢ºå®šé–‹å§‹æ ¡æ­£ã€‚')) {
                const statusEl = document.getElementById('status');
                statusEl.textContent = 'ğŸŸ¡ æ ¡æ­£ä¸­... è«‹ä¿æŒé¼“æ£’éœæ­¢';
                statusEl.className = 'status calibrating';

                fetch('/api/calibrate', { method: 'POST' })
                    .then(response => response.json())
                    .then(result => {
                        if (result.status === 'success') {
                            alert('âœ“ æ ¡æ­£å®Œæˆï¼');
                        } else {
                            alert('âœ— æ ¡æ­£å¤±æ•—: ' + result.message);
                        }
                    })
                    .catch(error => {
                        alert('âœ— æ ¡æ­£è«‹æ±‚å¤±æ•—: ' + error);
                    });
            }
        }

        // å®šæ™‚å–å¾—æ•¸æ“š
        function fetchData() {
            fetch('/api/data')
                .then(response => response.json())
                .then(data => updateDisplay(data))
                .catch(error => {
                    console.error('éŒ¯èª¤:', error);
                    showError();
                });
        }

        // æ¯ 50ms æ›´æ–°ä¸€æ¬¡æ•¸æ“šï¼ˆèˆ‡å¾Œç«¯åŒæ­¥ï¼‰
        setInterval(fetchData, 50);

        // é é¢è¼‰å…¥æ™‚ç«‹å³å–å¾—æ•¸æ“š
        fetchData();
    </script>
</body>
</html>
