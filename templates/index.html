<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Drumstick Visualizer</title>
    <style>
        body { background: #222; display: flex; justify-content: center; }
        canvas { background: #fff; margin-top: 20px; }
    </style>
</head>
<body>

<canvas id="drumCanvas" width="900" height="450"></canvas>

<script>
const canvas = document.getElementById("drumCanvas");
const ctx = canvas.getContext("2d");

const zones = [
    { name: "Symbal",    x: 0,   y: 0,   w: 225, h: 225, color:"#e5b3ff" },
    { name: "Tom_high",  x: 225, y: 0,   w: 225, h: 225, color:"#00c864" },
    { name: "Tom_mid",   x: 450, y: 0,   w: 225, h: 225, color:"#ff7f2a" },
    { name: "Ride",      x: 675, y: 0,   w: 225, h: 225, color:"#6eeee7" },

    { name: "Hihat",     x: 0,   y: 225, w: 225, h: 225, color:"#3232ff" },
    { name: "Snare",     x: 225, y: 225, w: 225, h: 225, color:"#d9d9d9" },
    { name: "Snare",     x: 450, y: 225, w: 225, h: 225, color:"#d9d9d9" },
    { name: "Tom_floor", x: 675, y: 225, w: 225, h: 225, color:"#4d4d4d" },
];

function mapAngleToXY(pitch, roll) {
    let x = (roll + 90) / 180 * canvas.width;
    let y = (pitch + 60) / 120 * canvas.height;

    x = Math.max(0, Math.min(canvas.width, x));
    y = Math.max(0, Math.min(canvas.height, y));

    return {x, y};
}

function draw(pitch, roll) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // draw zones
    zones.forEach(z => {
        ctx.fillStyle = z.color;
        ctx.fillRect(z.x, z.y, z.w, z.h);
        ctx.fillStyle = "#fff";
        ctx.font = "20px Arial";
        ctx.fillText(z.name, z.x + 10, z.y + 30);
    });

    // draw red dot
    const pos = mapAngleToXY(pitch, roll);
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.arc(pos.x, pos.y, 12, 0, Math.PI * 2);
    ctx.fill();
}

function update() {
    fetch("/data")
        .then(res => res.json())
        .then(d => {
            draw(d.pitch, d.roll);
        });

    requestAnimationFrame(update);
}

update();

</script>

</body>
</html>
