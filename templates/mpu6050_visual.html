<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPU6050 3D Visualization - Drum Stick</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow: hidden;
        }

        #container {
            display: flex;
            height: 100vh;
        }

        #canvas-container {
            flex: 1;
            position: relative;
        }

        #info-panel {
            width: 350px;
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #4fc3f7;
        }

        h2 {
            font-size: 18px;
            margin-top: 25px;
            margin-bottom: 15px;
            color: #81c784;
            border-bottom: 2px solid #81c784;
            padding-bottom: 5px;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 16px;
        }

        .data-label {
            color: #ccc;
        }

        .data-value {
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .roll { color: #ef5350; }
        .pitch { color: #66bb6a; }
        .yaw { color: #42a5f5; }
        .accel { color: #ffa726; }
        .gyro { color: #ab47bc; }
        .temp { color: #26c6da; }

        button {
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            font-size: 16px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .status {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 14px;
        }

        .connected {
            color: #66bb6a;
        }

        .disconnected {
            color: #ef5350;
        }

        .controls {
            margin-top: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .control-label {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 8px;
        }

        #help {
            margin-top: 25px;
            font-size: 13px;
            color: #999;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="canvas-container"></div>
        
        <div id="info-panel">
            <h1>ğŸ¥ MPU6050 3D è¦–è¦ºåŒ–</h1>
            <div class="status">
                é€£ç·šç‹€æ…‹: <span id="status" class="disconnected">æœªé€£æ¥</span>
            </div>

            <h2>å§¿æ…‹è§’åº¦</h2>
            <div class="data-row">
                <span class="data-label">Roll (æ©«æ»¾):</span>
                <span class="data-value roll" id="roll">0.00Â°</span>
            </div>
            <div class="data-row">
                <span class="data-label">Pitch (ä¿¯ä»°):</span>
                <span class="data-value pitch" id="pitch">0.00Â°</span>
            </div>
            <div class="data-row">
                <span class="data-label">Yaw (åèˆª):</span>
                <span class="data-value yaw" id="yaw">0.00Â°</span>
            </div>

            <h2>åŠ é€Ÿåº¦è¨ˆ (g)</h2>
            <div class="data-row">
                <span class="data-label">X:</span>
                <span class="data-value accel" id="accel-x">0.00</span>
            </div>
            <div class="data-row">
                <span class="data-label">Y:</span>
                <span class="data-value accel" id="accel-y">0.00</span>
            </div>
            <div class="data-row">
                <span class="data-label">Z:</span>
                <span class="data-value accel" id="accel-z">0.00</span>
            </div>

            <h2>é™€èºå„€ (Â°/s)</h2>
            <div class="data-row">
                <span class="data-label">X:</span>
                <span class="data-value gyro" id="gyro-x">0.0</span>
            </div>
            <div class="data-row">
                <span class="data-label">Y:</span>
                <span class="data-value gyro" id="gyro-y">0.0</span>
            </div>
            <div class="data-row">
                <span class="data-label">Z:</span>
                <span class="data-value gyro" id="gyro-z">0.0</span>
            </div>

            <h2>æº«åº¦</h2>
            <div class="data-row">
                <span class="data-label">Temperature:</span>
                <span class="data-value temp" id="temperature">0.0Â°C</span>
            </div>

            <h2>æ‰“æ“Šåµæ¸¬</h2>
            <div class="data-row">
                <span class="data-label">æ‰“æ“Šæ¬¡æ•¸:</span>
                <span class="data-value" id="hit-count" style="color: #ffa726;">0</span>
            </div>
            <div class="data-row">
                <span class="data-label">æœ€å¾Œå¼·åº¦:</span>
                <span class="data-value" id="hit-intensity" style="color: #ef5350;">0.00</span>
            </div>
            <div id="hit-indicator" style="
                margin-top: 15px;
                padding: 10px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
                text-align: center;
                font-size: 18px;
                font-weight: bold;
                transition: all 0.2s;
            ">
                å¾…æ©Ÿä¸­...
            </div>

            <div class="controls">
                <button id="reset-btn">ğŸ”„ é‡ç½®å§¿æ…‹</button>
            </div>

            <div id="help">
                <strong>æ“ä½œèªªæ˜:</strong><br>
                â€¢ <strong>é¦–æ¬¡ä½¿ç”¨: è«‹é»æ“Šé é¢å•Ÿç”¨éŸ³æ•ˆ</strong><br>
                â€¢ æ»‘é¼ æ‹–æ›³: æ—‹è½‰è¦–è§’<br>
                â€¢ æ»¾è¼ª: ç¸®æ”¾<br>
                â€¢ é‡ç½®æŒ‰éˆ•: æ­¸é›¶å§¿æ…‹<br>
                â€¢ å³æ™‚é¡¯ç¤ºæ„Ÿæ¸¬å™¨ç‹€æ…‹<br>
                â€¢ æ®æ“Šé¼“æ£’æ™‚è‡ªå‹•æ’­æ”¾éŸ³æ•ˆ
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // Three.js å ´æ™¯è¨­å®š
        let scene, camera, renderer, cube, axes;
        let socket;
        
        // Web Audio API éŸ³æ•ˆç³»çµ±
        let audioContext;
        let drumSoundBuffer;
        let audioInitialized = false;

        // åˆå§‹åŒ– Web Audio
        function initAudio() {
            if (audioInitialized) return;
            
            console.log('ğŸµ é–‹å§‹åˆå§‹åŒ–éŸ³æ•ˆç³»çµ±...');
            
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log('âœ“ Web Audio Context åˆå§‹åŒ–æˆåŠŸ');
                
                // è¼‰å…¥é¼“è²éŸ³æ•ˆ
                console.log('ğŸ“¥ æ­£åœ¨è¼‰å…¥éŸ³æ•ˆæª”æ¡ˆ: /static/big_drum.wav');
                
                fetch('/static/big_drum.wav')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        console.log('âœ“ éŸ³æ•ˆæª”æ¡ˆä¸‹è¼‰æˆåŠŸ');
                        return response.arrayBuffer();
                    })
                    .then(arrayBuffer => {
                        console.log('ğŸ”„ æ­£åœ¨è§£ç¢¼éŸ³æ•ˆ...');
                        return audioContext.decodeAudioData(arrayBuffer);
                    })
                    .then(audioBuffer => {
                        drumSoundBuffer = audioBuffer;
                        audioInitialized = true;
                        console.log('âœ“ é¼“è²éŸ³æ•ˆè¼‰å…¥æˆåŠŸ');
                        console.log(`   é•·åº¦: ${audioBuffer.duration.toFixed(2)} ç§’`);
                        console.log(`   æ¡æ¨£ç‡: ${audioBuffer.sampleRate} Hz`);
                        
                        // é¡¯ç¤ºæç¤º
                        const indicator = document.getElementById('hit-indicator');
                        indicator.textContent = 'âœ“ éŸ³æ•ˆå·²å°±ç·’';
                        indicator.style.color = '#4fc3f7';
                        setTimeout(() => {
                            indicator.textContent = 'å¾…æ©Ÿä¸­...';
                            indicator.style.color = 'white';
                        }, 2000);
                    })
                    .catch(error => {
                        console.error('âŒ éŸ³æ•ˆè¼‰å…¥å¤±æ•—:', error);
                        console.error('   éŒ¯èª¤è©³æƒ…:', error.message);
                        
                        const indicator = document.getElementById('hit-indicator');
                        
                        // æ ¹æ“šéŒ¯èª¤é¡å‹é¡¯ç¤ºä¸åŒè¨Šæ¯
                        if (error.message.includes('404')) {
                            indicator.textContent = 'âŒ æ‰¾ä¸åˆ°éŸ³æ•ˆæª”æ¡ˆ';
                            console.error('   â†’ è«‹ç¢ºèª static/big_drum.wav å­˜åœ¨');
                            console.error('   â†’ åŸ·è¡Œ: cp big_drum.wav static/');
                        } else if (error.message.includes('decode')) {
                            indicator.textContent = 'âŒ éŸ³æ•ˆæ ¼å¼éŒ¯èª¤';
                            console.error('   â†’ éŸ³æ•ˆæª”æ¡ˆæ ¼å¼ä¸æ”¯æ´');
                            console.error('   â†’ å»ºè­°ä½¿ç”¨æ¨™æº– WAV æ ¼å¼');
                        } else {
                            indicator.textContent = 'âŒ éŸ³æ•ˆè¼‰å…¥å¤±æ•—';
                        }
                        
                        indicator.style.color = '#ef5350';
                    });
            } catch (error) {
                console.error('âŒ Web Audio åˆå§‹åŒ–å¤±æ•—:', error);
                const indicator = document.getElementById('hit-indicator');
                indicator.textContent = 'âŒ ç€è¦½å™¨ä¸æ”¯æ´';
                indicator.style.color = '#ef5350';
            }
        }

        // æ’­æ”¾é¼“è²
        function playDrumSound(intensity = 1.0) {
            if (!audioInitialized || !drumSoundBuffer) {
                console.warn('âš  éŸ³æ•ˆå°šæœªå°±ç·’ï¼Œç„¡æ³•æ’­æ”¾');
                return;
            }

            try {
                // å»ºç«‹éŸ³æº
                const source = audioContext.createBufferSource();
                source.buffer = drumSoundBuffer;
                
                // å»ºç«‹éŸ³é‡æ§åˆ¶
                const gainNode = audioContext.createGain();
                const volume = Math.min(1.0, 0.5 + intensity * 0.5);
                gainNode.gain.value = volume;
                
                // é€£æ¥ç¯€é»
                source.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // æ’­æ”¾
                source.start(0);
                console.log(`ğŸ”Š æ’­æ”¾éŸ³æ•ˆ (éŸ³é‡: ${(volume * 100).toFixed(0)}%)`);
            } catch (error) {
                console.error('âŒ æ’­æ”¾éŸ³æ•ˆéŒ¯èª¤:', error);
            }
        }

        // ä½¿ç”¨è€…äº’å‹•å¾Œåˆå§‹åŒ–éŸ³æ•ˆï¼ˆç€è¦½å™¨è¦æ±‚ï¼‰
        document.addEventListener('click', function initOnInteraction() {
            console.log('ğŸ‘† åµæ¸¬åˆ°ä½¿ç”¨è€…é»æ“Šï¼Œåˆå§‹åŒ–éŸ³æ•ˆ...');
            initAudio();
            document.removeEventListener('click', initOnInteraction);
        }, { once: true });

        // é é¢è¼‰å…¥æ™‚ä¹Ÿå˜—è©¦åˆå§‹åŒ–ï¼ˆæŸäº›ç€è¦½å™¨å…è¨±ï¼‰
        window.addEventListener('load', function() {
            console.log('ğŸ“„ é é¢è¼‰å…¥å®Œæˆ');
            console.log('ğŸ’¡ æç¤º: è«‹é»æ“Šé é¢ä»»æ„ä½ç½®ä»¥å•Ÿç”¨éŸ³æ•ˆ');
        });

        function initThreeJS() {
            // å ´æ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);

            // ç›¸æ©Ÿ
            const container = document.getElementById('canvas-container');
            camera = new THREE.PerspectiveCamera(
                45,
                container.clientWidth / container.clientHeight,
                0.1,
                1000
            );
            camera.position.set(0, 8, 12);
            camera.lookAt(0, 2, 0);

            // æ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);

            // å…‰æº
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -10;
            directionalLight.shadow.camera.right = 10;
            directionalLight.shadow.camera.top = 10;
            directionalLight.shadow.camera.bottom = -10;
            scene.add(directionalLight);

            // èšå…‰ç‡ˆ (æ‰“åœ¨é¼“ä¸Š)
            const spotLight = new THREE.SpotLight(0xffffff, 0.5);
            spotLight.position.set(0, 15, 0);
            spotLight.angle = Math.PI / 4;
            spotLight.penumbra = 0.3;
            spotLight.castShadow = true;
            scene.add(spotLight);

            // å»ºç«‹é¼“æ£’ (åœ“æŸ±é«”)
            const drumstick = new THREE.Group();
            
            // é¼“æ£’ä¸»é«” (æœ¨è³ªéƒ¨åˆ†)
            const stickGeometry = new THREE.CylinderGeometry(0.08, 0.08, 3, 16);
            const stickMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x8B4513,
                shininess: 30
            });
            const stick = new THREE.Mesh(stickGeometry, stickMaterial);
            stick.castShadow = true;
            drumstick.add(stick);
            
            // é¼“æ£’é ­ (æ‰“æ“Šéƒ¨åˆ†)
            const tipGeometry = new THREE.SphereGeometry(0.15, 16, 16);
            const tipMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xD2691E,
                shininess: 50
            });
            const tip = new THREE.Mesh(tipGeometry, tipMaterial);
            tip.position.y = 1.5;
            tip.castShadow = true;
            drumstick.add(tip);
            
            // é¼“æ£’å°¾ç«¯ (æ¡æŠŠ)
            const gripGeometry = new THREE.CylinderGeometry(0.1, 0.12, 0.6, 16);
            const gripMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x654321,
                shininess: 20
            });
            const grip = new THREE.Mesh(gripGeometry, gripMaterial);
            grip.position.y = -1.5;
            grip.castShadow = true;
            drumstick.add(grip);
            
            // èª¿æ•´é¼“æ£’ä½ç½®
            drumstick.position.set(0, 3, 0);
            drumstick.rotation.z = Math.PI / 6; // ç¨å¾®å‚¾æ–œ
            scene.add(drumstick);
            cube = drumstick; // æ²¿ç”¨åŸè®Šæ•¸åç¨±

            // å»ºç«‹çˆµå£«é¼“çµ„
            createDrumKit();

            // åº§æ¨™è»¸ (å¯é¸)
            // axes = new THREE.AxesHelper(3);
            // scene.add(axes);

            // åœ°æ¿
            const floorGeometry = new THREE.PlaneGeometry(30, 30);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x1a1a1a,
                roughness: 0.8
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // åˆå§‹åŒ–æ»‘é¼ æ§åˆ¶
            initMouseControls();

            // éŸ¿æ‡‰å¼èª¿æ•´
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });

            animate();
        }

        function createDrumKit() {
            // å·¦é‚Šé¼“ (Tom 1 - ç´…è‰²)
            const leftDrum = createDrum(0xff3333, 1.0, 0.5);
            leftDrum.position.set(-3, 0.5, 0);
            scene.add(leftDrum);
            
            // ä¸­é–“é¼“ (Snare - éŠ€è‰²)
            const centerDrum = createDrum(0xcccccc, 1.2, 0.6);
            centerDrum.position.set(0, 0.6, 0);
            scene.add(centerDrum);
            
            // å³é‚Šé¼“ (Tom 2 - è—è‰²)
            const rightDrum = createDrum(0x3333ff, 1.0, 0.5);
            rightDrum.position.set(3, 0.5, 0);
            scene.add(rightDrum);
            
            // åœ°é¼“ (Kick - é»‘è‰²) - èƒŒæ™¯
            const kickDrum = createKickDrum();
            kickDrum.position.set(0, 0.8, -3);
            scene.add(kickDrum);
        }

        function createDrum(color, radius, height) {
            const drum = new THREE.Group();
            
            // é¼“èº«
            const bodyGeometry = new THREE.CylinderGeometry(radius, radius, height, 32);
            const bodyMaterial = new THREE.MeshPhongMaterial({ 
                color: color,
                shininess: 60
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.castShadow = true;
            body.receiveShadow = true;
            drum.add(body);
            
            // é¼“é¢ (ç™½è‰²)
            const headGeometry = new THREE.CircleGeometry(radius, 32);
            const headMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xf5f5f5,
                shininess: 30,
                side: THREE.DoubleSide
            });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.rotation.x = -Math.PI / 2;
            head.position.y = height / 2 + 0.01;
            head.receiveShadow = true;
            drum.add(head);
            
            // é¼“é‚Š (é‡‘å±¬ç’°)
            const rimGeometry = new THREE.TorusGeometry(radius, 0.03, 16, 32);
            const rimMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x888888,
                metalness: 0.9,
                roughness: 0.2
            });
            const rim = new THREE.Mesh(rimGeometry, rimMaterial);
            rim.rotation.x = Math.PI / 2;
            rim.position.y = height / 2;
            rim.castShadow = true;
            drum.add(rim);
            
            return drum;
        }

        function createKickDrum() {
            const kick = new THREE.Group();
            
            // å¤§é¼“èº« (æ©«æ”¾)
            const bodyGeometry = new THREE.CylinderGeometry(1.5, 1.5, 1.2, 32);
            const bodyMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x000000,
                shininess: 80
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.rotation.z = Math.PI / 2;
            body.castShadow = true;
            body.receiveShadow = true;
            kick.add(body);
            
            // é¼“é¢
            const headGeometry = new THREE.CircleGeometry(1.5, 32);
            const headMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xffffff,
                shininess: 30
            });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.z = 0.6;
            head.receiveShadow = true;
            kick.add(head);
            
            // Logo (é»‘è‰²åœ“å½¢)
            const logoGeometry = new THREE.CircleGeometry(0.5, 32);
            const logoMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const logo = new THREE.Mesh(logoGeometry, logoMaterial);
            logo.position.z = 0.61;
            kick.add(logo);
            
            return kick;
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function updateOrientation(roll, pitch, yaw) {
            // Three.js ä½¿ç”¨å¼§åº¦
            const rollRad = roll * Math.PI / 180;
            const pitchRad = pitch * Math.PI / 180;
            const yawRad = yaw * Math.PI / 180;

            // è¨­å®šé¼“æ£’å§¿æ…‹ (å¾æ°´å¹³åç§»é–‹å§‹)
            // åŸºç¤å§¿æ…‹ï¼šé¼“æ£’ç¨å¾®å‘å³ä¸‹æ–¹å‚¾æ–œ
            const baseRotation = Math.PI / 6;
            cube.rotation.set(-pitchRad, yawRad, baseRotation - rollRad, 'XYZ');
        }

        function initMouseControls() {
            // æ»‘é¼ æ§åˆ¶
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };

            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });

            renderer.domElement.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaX = e.clientX - previousMousePosition.x;
                    const deltaY = e.clientY - previousMousePosition.y;
                    
                    camera.position.x += deltaX * 0.01;
                    camera.position.y -= deltaY * 0.01;
                    camera.lookAt(0, 2, 0);
                    
                    previousMousePosition = { x: e.clientX, y: e.clientY };
                }
            });

            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });

            // æ»¾è¼ªç¸®æ”¾
            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? 1.1 : 0.9;
                camera.position.multiplyScalar(delta);
            });
        }

        function updateUI(data) {
            // å§¿æ…‹è§’åº¦
            document.getElementById('roll').textContent = data.roll.toFixed(2) + 'Â°';
            document.getElementById('pitch').textContent = data.pitch.toFixed(2) + 'Â°';
            document.getElementById('yaw').textContent = data.yaw.toFixed(2) + 'Â°';

            // åŠ é€Ÿåº¦è¨ˆ
            document.getElementById('accel-x').textContent = data.accel.x.toFixed(2);
            document.getElementById('accel-y').textContent = data.accel.y.toFixed(2);
            document.getElementById('accel-z').textContent = data.accel.z.toFixed(2);

            // é™€èºå„€
            document.getElementById('gyro-x').textContent = data.gyro.x.toFixed(1);
            document.getElementById('gyro-y').textContent = data.gyro.y.toFixed(1);
            document.getElementById('gyro-z').textContent = data.gyro.z.toFixed(1);

            // æº«åº¦
            document.getElementById('temperature').textContent = data.temperature.toFixed(1) + 'Â°C';

            // æ‰“æ“Šåµæ¸¬
            if (data.hit_count !== undefined) {
                document.getElementById('hit-count').textContent = data.hit_count;
            }
            
            if (data.hit_intensity !== undefined) {
                document.getElementById('hit-intensity').textContent = data.hit_intensity.toFixed(2);
            }
            
            // æ‰“æ“Šè¦–è¦ºæ•ˆæœ
            const hitIndicator = document.getElementById('hit-indicator');
            if (data.hit_detected) {
                const intensity = data.hit_intensity;
                let level = 'è¼•æ“Š';
                let color = '#4fc3f7';
                
                if (intensity >= 0.7) {
                    level = 'é‡æ“Š';
                    color = '#ef5350';
                } else if (intensity >= 0.4) {
                    level = 'ä¸­æ“Š';
                    color = '#ffa726';
                }
                
                hitIndicator.textContent = 'ğŸ¥ ' + level + 'ï¼';
                hitIndicator.style.background = color;
                hitIndicator.style.transform = 'scale(1.1)';
                
                // æ’­æ”¾éŸ³æ•ˆ
                playDrumSound(intensity);
                
                // é¼“é¢é–ƒå…‰æ•ˆæœ
                flashDrums(intensity);
                
                // æ¢å¾©
                setTimeout(() => {
                    hitIndicator.style.background = 'rgba(255, 255, 255, 0.05)';
                    hitIndicator.style.transform = 'scale(1)';
                    hitIndicator.textContent = 'å¾…æ©Ÿä¸­...';
                }, 200);
            }

            // æ›´æ–° 3D å§¿æ…‹
            updateOrientation(data.roll, data.pitch, data.yaw);
        }

        function flashDrums(intensity) {
            // è®“é¼“é¢ç”¢ç”Ÿé–ƒå…‰æ•ˆæœï¼ˆå¯é¸ï¼‰
            // é€™è£¡å¯ä»¥æ·»åŠ æ›´å¤šè¦–è¦ºæ•ˆæœ
        }

        function initWebSocket() {
            socket = io();

            socket.on('connect', () => {
                console.log('WebSocket å·²é€£æ¥');
                document.getElementById('status').textContent = 'å·²é€£æ¥';
                document.getElementById('status').className = 'connected';
            });

            socket.on('disconnect', () => {
                console.log('WebSocket å·²æ–·ç·š');
                document.getElementById('status').textContent = 'æœªé€£æ¥';
                document.getElementById('status').className = 'disconnected';
            });

            socket.on('sensor_data', (data) => {
                updateUI(data);
            });
        }

        // é‡ç½®æŒ‰éˆ•
        document.getElementById('reset-btn').addEventListener('click', () => {
            socket.emit('reset');
            console.log('å·²ç™¼é€é‡ç½®æŒ‡ä»¤');
        });

        // åˆå§‹åŒ–
        initThreeJS();
        initWebSocket();
    </script>
</body>
</html>
