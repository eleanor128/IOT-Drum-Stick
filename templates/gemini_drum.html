<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D 爵士鼓組背景</title>
    <!-- 引入 Tailwind CSS 以進行基礎佈局和響應式設計 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Three.js 函式庫 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- 引入 Three.js 的 OrbitControls，用於讓使用者可以旋轉視角 -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden; /* 隱藏滾動條 */
            background-color: #0d0d0d; /* 深色背景模擬爵士俱樂部 */
        }
        #scene-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <div id="scene-container">
        <!-- 3D 渲染器將會將 canvas 元素放置在此處 -->
    </div>
    <div id="loading-overlay" class="absolute inset-0 bg-gray-900 flex flex-col items-center justify-center text-white z-10 transition-opacity duration-1000">
        <div class="text-3xl font-bold mb-4">正在載入 3D 爵士鼓組...</div>
        <div class="text-lg text-gray-400">請拖曳滑鼠來旋轉視角</div>
    </div>

    <script>
        // 設定 Firebase 相關變數（此應用程式不需要 Firestore 或 Auth，故保留為空或預設值）
        const __app_id = '3d-jazz-drum-kit';
        const __firebase_config = '{}';
        const __initial_auth_token = undefined;


        let scene, camera, renderer, controls;
        const container = document.getElementById('scene-container');
        const loadingOverlay = document.getElementById('loading-overlay');

        // --- 輔助函數：創建鼓 (Drum) ---
        function createDrum(radius, height, color, position, rotation) {
            const geometry = new THREE.CylinderGeometry(radius, radius, height, 32);
            const material = new THREE.MeshPhongMaterial({
                color: color,
                shininess: 80,
                specular: 0x555555
            });
            const drum = new THREE.Mesh(geometry, material);
            drum.position.set(position.x, position.y + height / 2, position.z);
            if (rotation) {
                drum.rotation.set(rotation.x, rotation.y, rotation.z);
            }
            scene.add(drum);
            return drum;
        }

        // --- 輔助函數：創建鈸 (Cymbal) ---
        function createCymbal(radius, thickness, position, rotation) {
            const geometry = new THREE.CylinderGeometry(radius, radius * 0.9, thickness, 64);
            const material = new THREE.MeshStandardMaterial({
                color: 0xAAAA00, // 黃銅色
                metalness: 0.9,
                roughness: 0.2,
                side: THREE.DoubleSide
            });
            const cymbal = new THREE.Mesh(geometry, material);
            cymbal.position.set(position.x, position.y, position.z);
            if (rotation) {
                cymbal.rotation.set(rotation.x, rotation.y, rotation.z);
            }
            scene.add(cymbal);
            return cymbal;
        }

        // --- 輔助函數：創建支架 (Stand Pole) ---
        function createStand(x, y, z, height) {
            const geometry = new THREE.CylinderGeometry(0.05, 0.05, height, 8);
            const material = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const stand = new THREE.Mesh(geometry, material);
            stand.position.set(x, y + height / 2, z);
            scene.add(stand);
            return stand;
        }

        // --- 初始化 3D 場景 ---
        function init() {
            // 1. 場景 (Scene)
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050505); // 幾乎全黑的背景

            // 2. 相機 (Camera)
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(3, 4, 5); // 初始視角

            // 3. 渲染器 (Renderer)
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true; // 開啟陰影
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);

            // 4. 燈光 (Lighting)
            // 基礎環境光 (Ambient Light) - 提供微弱的整體照明
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);

            // 聚光燈 (Spotlight) - 模擬舞台燈光，聚焦在鼓組上
            const spotlightColor = 0xFFFFFF;
            const intensity = 3.5;
            const distance = 10;
            const angle = Math.PI / 8;
            const penumbra = 0.5;

            // 聚光燈 1 (左上方)
            const spotLight1 = new THREE.SpotLight(spotlightColor, intensity, distance, angle, penumbra, 0.5);
            spotLight1.position.set(-3, 6, 2);
            spotLight1.target.position.set(0, 0.5, 0); // 指向鼓組中心
            spotLight1.castShadow = true;
            spotLight1.shadow.mapSize.width = 1024;
            spotLight1.shadow.mapSize.height = 1024;
            scene.add(spotLight1);
            scene.add(spotLight1.target);

            // 聚光燈 2 (右上方)
            const spotLight2 = new THREE.SpotLight(spotlightColor, intensity, distance, angle, penumbra, 0.5);
            spotLight2.position.set(3, 6, 2);
            spotLight2.target.position.set(0, 0.5, 0); // 指向鼓組中心
            spotLight2.castShadow = true;
            scene.add(spotLight2);
            scene.add(spotLight2.target);

            // 5. 地板 (Floor/Stage)
            const floorGeometry = new THREE.PlaneGeometry(15, 15);
            const floorMaterial = new THREE.MeshLambertMaterial({ color: 0x1A1A1A }); // 深灰色舞台
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);


            // 6. 創建爵士鼓組 (Create the Jazz Drum Kit)
            const DRUM_COLOR = 0x8B0000; // 深紅色/酒紅色，經典爵士鼓色
            const BASE_Y = 0; // 地板高度

            // --- 大鼓 (Bass Drum) ---
            const bassDrum = createDrum(0.8, 0.7, DRUM_COLOR, { x: 0, y: BASE_Y, z: 0 }, { x: 0, y: 0, z: 0 });
            bassDrum.castShadow = true;

            // --- 小鼓 (Snare Drum) ---
            const snareStandHeight = 0.5;
            createStand(-1.0, BASE_Y, 0.5, snareStandHeight); // 小鼓支架
            const snareDrum = createDrum(0.35, 0.2, 0xFFFFFF, { x: -1.0, y: BASE_Y + snareStandHeight, z: 0.5 }, { x: -Math.PI / 16, y: 0, z: 0 }); // 輕微傾斜
            snareDrum.castShadow = true;

            // --- 中鼓 (Rack Tom) ---
            const tomStandHeight = 0.9;
            createStand(0.6, BASE_Y, -0.6, tomStandHeight); // 中鼓支架
            const rackTom = createDrum(0.3, 0.3, DRUM_COLOR, { x: 0.6, y: BASE_Y + tomStandHeight, z: -0.6 }, { x: Math.PI / 16, y: 0, z: 0 }); // 輕微傾斜
            rackTom.castShadow = true;


            // --- 鈸架 (Cymbal Stands) ---
            const standHeightTall = 1.2;
            const standHeightMedium = 0.9;

            // Hi-Hat 踏鈸 (左側)
            const hiHatStand = createStand(-1.5, BASE_Y, -0.2, standHeightTall);
            const hiHatBottom = createCymbal(0.4, 0.02, { x: -1.5, y: BASE_Y + standHeightTall, z: -0.2 }, { x: 0, y: 0, z: 0 });
            const hiHatTop = createCymbal(0.38, 0.01, { x: -1.5, y: BASE_Y + standHeightTall + 0.02, z: -0.2 }, { x: 0, y: 0, z: 0 });
            hiHatBottom.castShadow = true;
            hiHatTop.castShadow = true;

            // Ride Cymbal 大鈸 (右側)
            const rideStand = createStand(1.8, BASE_Y, 0.5, standHeightTall);
            const rideCymbal = createCymbal(0.6, 0.02, { x: 1.8, y: BASE_Y + standHeightTall + 0.05, z: 0.5 }, { x: Math.PI / 8, y: 0, z: 0 }); // 輕微傾斜
            rideCymbal.castShadow = true;

            // Crash Cymbal 碎鈸 (後側)
            const crashStand = createStand(0.5, BASE_Y, -1.5, standHeightTall + 0.5);
            const crashCymbal = createCymbal(0.5, 0.02, { x: 0.5, y: BASE_Y + standHeightTall + 0.5 + 0.05, z: -1.5 }, { x: Math.PI / 12, y: 0, z: 0 }); // 輕微傾斜
            crashCymbal.castShadow = true;


            // 7. 操控 (Controls)
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 1, 0); // 讓相機圍繞鼓組中心旋轉
            controls.enableDamping = true; // 啟用阻尼效果（平滑運動）
            controls.dampingFactor = 0.05;
            controls.minDistance = 2;
            controls.maxDistance = 10;
            controls.maxPolarAngle = Math.PI / 2.1; // 限制視角不能穿過地板

            // 8. 響應式設計 (Resize handling)
            window.addEventListener('resize', onWindowResize, false);

            // 隱藏載入畫面
            setTimeout(() => {
                loadingOverlay.style.opacity = '0';
                setTimeout(() => loadingOverlay.style.display = 'none', 1000);
            }, 500);

        }

        // --- 視窗大小改變處理 ---
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- 動畫循環 (Animation Loop) ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update(); // 只有在 controls.enableDamping 設為 true 時才需要
            renderer.render(scene, camera);
        }

        // --- 啟動應用程式 ---
        window.onload = function () {
            init();
            animate();
        };

    </script>
</body>
</html>