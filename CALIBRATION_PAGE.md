# 鼓棒參數微調頁面

## 🎯 功能說明

這是一個專門用於 MPU6050 感測器參數微調的獨立頁面，提供直觀的 3D 視覺化界面和完整的校準控制。

## 📍 訪問方式

啟動 Flask 伺服器後，在瀏覽器中訪問：

```
http://localhost:5001/calibration
```

或在樹莓派上：

```
http://<樹莓派IP>:5001/calibration
```

## ✨ 主要功能

### 1. 即時數據顯示（左側面板）
- ✅ WebSocket 連線狀態
- 📊 Roll / Pitch / Yaw 角度
- 📈 三軸加速度 (X, Y, Z)
- 🌡️ 感測器溫度

### 2. 3D 視覺化場景
- 🎨 深色背景，專業視覺效果
- 📐 明顯的 XYZ 座標軸（紅/綠/藍）
- 🥢 3D 鼓棒模型，即時跟隨感測器姿態
- 🔄 相機自動環繞視角

### 3. 位置偏移控制（右側面板）
- **X 軸偏移**：左右移動鼓棒 (-10 ~ +10)
- **Y 軸偏移**：上下移動鼓棒 (-10 ~ +10)
- **Z 軸偏移**：前後移動鼓棒 (-10 ~ +10)
- 🎚️ 滑桿 + 精確數字輸入
- ✓ 套用位置按鈕
- ↺ 重置位置按鈕

### 4. 旋轉偏移控制

- **Roll 偏移**：滾動角度補償 (-180° ~ +180°)
- **Pitch 偏移**：俯仰角度補償 (-180° ~ +180°)
- **Yaw 偏移**：偏航角度補償 (-180° ~ +180°)
- ✓ 套用旋轉按鈕
- ↺ 重置旋轉按鈕

### 5. 軸方向反轉

- ☑️ **反轉 Roll 軸**：如果橫滾方向相反，勾選此項
- ☑️ **反轉 Pitch 軸**：如果俯仰方向相反，勾選此項
- ☑️ **反轉 Yaw 軸**：如果偏航方向相反，勾選此項
- 💡 勾選後即時生效，移動方向會立即反轉

### 6. 快速動作

- 🎯 **自動校準**：將當前姿態設為零點（偏移 = -當前角度）
- 🔄 **全部重置**：清除所有位置和旋轉偏移
- 💾 **儲存設定**：將參數存到瀏覽器 localStorage
- 📂 **載入設定**：從 localStorage 讀取上次的設定

## 🎮 使用流程

### 基本校準流程

1. **啟動伺服器**
   ```bash
   python mpu6050_web_visual.py
   ```

2. **打開校準頁面**
   - 訪問 `http://localhost:5001/calibration`
   - 確認左上角顯示「已連接」

3. **觀察當前狀態**
   - 查看即時數據面板的 Roll/Pitch/Yaw 值
   - 觀察 3D 場景中鼓棒的姿態

4. **執行自動校準**
   - 將鼓棒放在理想的「零點」位置
   - 點擊 🎯 **自動校準** 按鈕
   - 系統會計算並套用偏移量，使當前姿態變為 (0°, 0°, 0°)

5. **手動微調（選用）**
   - 使用滑桿調整各軸的旋轉偏移
   - 實時觀察 3D 場景中的變化
   - 點擊 ✓ **套用旋轉** 確認

6. **調整位置（選用）**
   - 使用位置偏移滑桿移動鼓棒在 3D 空間的位置
   - 用於調整顯示效果，不影響感測器數據

7. **儲存設定**
   - 點擊 💾 **儲存設定**
   - 下次開啟頁面時點擊 📂 **載入設定** 即可恢復

## 📐 座標軸說明

頁面左下角有座標軸圖例：

- 🔴 **X 軸（紅色）**：左右方向（水平橫向）
- 🟢 **Y 軸（綠色）**：上下方向（垂直）
- 🔵 **Z 軸（藍色）**：前後方向（深度）

原點位於場景中心，有白色小球標記。

## 🔧 技術細節

### 旋轉計算公式

```javascript
// 最終旋轉 = 感測器數據 + 用戶設定的偏移
finalRoll = sensorRoll + rotationOffset.roll
finalPitch = sensorPitch + rotationOffset.pitch
finalYaw = sensorYaw + rotationOffset.yaw
```

### 自動校準原理

將當前感測器讀數取負值作為偏移：

```javascript
rotationOffset.roll = -currentSensorData.roll
rotationOffset.pitch = -currentSensorData.pitch
rotationOffset.yaw = -currentSensorData.yaw
```

這樣 `sensorData + offset = 0`，實現歸零效果。

## 💡 使用技巧

1. **校準時機**：
   - 首次使用前必須校準
   - 更換電池或重新接線後重新校準
   - 感測器明顯漂移時重新校準

2. **最佳實踐**：
   - 校準時將鼓棒放在水平、靜止狀態
   - 避免在移動中執行自動校準
   - 定期儲存設定，避免重複調整

3. **故障排除**：
   - 如果畫面不動，檢查 WebSocket 連線狀態
   - 如果鼓棒旋轉異常，嘗試「全部重置」
   - 如果參數不生效，記得點擊「套用」按鈕

## 🎨 界面特色

- 🌙 **深色主題**：舒適的視覺體驗，減少眼睛疲勞
- 🎭 **漸層按鈕**：現代化的 UI 設計
- 💫 **動態效果**：按鈕懸停、點擊回饋
- 📱 **響應式**：自動適應不同螢幕尺寸
- 🎬 **平滑動畫**：相機環繞、物體移動都很流暢

## 🔗 相關頁面

- **主頁面**（完整遊戲）：`http://localhost:5001/`
- **參數微調**（本頁面）：`http://localhost:5001/calibration`

## 📝 注意事項

⚠️ **重要**：
- 設定儲存在瀏覽器的 localStorage 中，清除瀏覽器數據會丟失設定
- 不同瀏覽器的設定是獨立的
- 偏移量只影響顯示，不會改變感測器原始數據
- 建議定期匯出設定（未來功能）

---

**版本**: 1.0  
**日期**: 2025-12-02  
**作者**: Eleanor
