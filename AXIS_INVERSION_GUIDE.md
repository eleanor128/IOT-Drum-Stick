# 軸方向反轉功能說明

## 🔀 功能概述

如果你發現鼓棒的移動方向與實際感測器移動方向相反，可以使用「軸方向反轉」功能來修正。

## 🎯 使用場景

### 常見問題

1. **Roll 軸反了**
   - 問題：向左傾斜時，畫面中的鼓棒向右
   - 解決：勾選 ☑️ 反轉 Roll 軸

2. **Pitch 軸反了**
   - 問題：向前傾斜時，畫面中的鼓棒向後
   - 解決：勾選 ☑️ 反轉 Pitch 軸

3. **Yaw 軸反了**
   - 問題：向右旋轉時，畫面中的鼓棒向左
   - 解決：勾選 ☑️ 反轉 Yaw 軸

## 📍 功能位置

在校準頁面 (`http://localhost:5001/calibration`) 的右側控制面板中：

```
🔄 旋轉偏移 (Rotation Offset)
  └─ Roll/Pitch/Yaw 滑桿...

🔀 軸方向反轉 (Axis Inversion)  ← 這裡！
  ├─ ☑️ 反轉 Roll 軸 (橫滾)
  ├─ ☑️ 反轉 Pitch 軸 (俯仰)
  └─ ☑️ 反轉 Yaw 軸 (偏航)

⚡ 快速動作
  └─ ...
```

## 🎮 操作步驟

### 方法 1：測試法（推薦）

1. **開啟校準頁面**
   ```
   http://localhost:5001/calibration
   ```

2. **測試每個軸**
   - Roll：將鼓棒向左傾斜，觀察畫面
     - 如果畫面向右 → 勾選「反轉 Roll 軸」
   - Pitch：將鼓棒向前傾斜，觀察畫面
     - 如果畫面向後 → 勾選「反轉 Pitch 軸」
   - Yaw：將鼓棒向右旋轉，觀察畫面
     - 如果畫面向左 → 勾選「反轉 Yaw 軸」

3. **儲存設定**
   - 點擊 💾 **儲存設定**
   - 下次開啟會自動載入

### 方法 2：直接調整

如果你已經知道哪個軸需要反轉：

1. 直接勾選對應的複選框
2. 即時生效，不需要點擊套用
3. 記得儲存設定

## 🔧 技術細節

### 反轉原理

```javascript
// 原本
rotation = sensorData.roll + offset.roll

// 反轉後
rotation = -sensorData.roll + offset.roll
```

反轉會在**偏移量之前**應用，這樣可以確保：
1. 方向先修正
2. 再加上你的偏移調整

### 數學公式

```
最終角度 = (感測器數據 × 反轉係數) + 偏移量

其中：
- 反轉係數 = -1 (勾選) 或 1 (未勾選)
- 偏移量 = 你手動調整的值
```

## 💾 設定儲存

軸反轉設定會與其他校準參數一起儲存：

```json
{
  "position": { "x": 0, "y": 0, "z": 0 },
  "rotation": { "roll": 0, "pitch": 0, "yaw": 0 },
  "inversion": { 
    "roll": true,    // Roll 軸已反轉
    "pitch": false,  // Pitch 軸正常
    "yaw": false     // Yaw 軸正常
  }
}
```

儲存位置：瀏覽器 localStorage（鍵名：`drumstick-calibration`）

## ⚠️ 注意事項

1. **即時生效**
   - 勾選/取消勾選後立即生效
   - 不需要點擊「套用」按鈕

2. **與偏移量配合**
   - 反轉是在偏移之前處理的
   - 如果同時使用反轉和偏移，順序為：
     1. 先反轉方向
     2. 再加上偏移量

3. **全部重置會清除反轉設定**
   - 點擊 🔄 **全部重置** 會取消所有反轉
   - 如需保留，請先儲存設定

4. **不同瀏覽器獨立**
   - Chrome 和 Firefox 的設定是分開的
   - 換電腦也需要重新設定

## 🎯 實用技巧

### 快速診斷

| 測試動作 | 預期畫面反應 | 如果相反則勾選 |
|---------|-------------|--------------|
| 向左傾斜 | 向左傾斜 | ☑️ 反轉 Roll |
| 向前傾斜 | 向前傾斜 | ☑️ 反轉 Pitch |
| 順時針轉 | 順時針轉 | ☑️ 反轉 Yaw |

### 組合使用

```
場景：Roll 和 Pitch 都反了

步驟：
1. ☑️ 反轉 Roll 軸
2. ☑️ 反轉 Pitch 軸
3. 測試移動是否正確
4. 💾 儲存設定
```

### 匯出/匯入設定（手動）

1. **匯出**
   ```javascript
   // 在瀏覽器 Console 執行
   console.log(localStorage.getItem('drumstick-calibration'));
   // 複製輸出的 JSON
   ```

2. **匯入**
   ```javascript
   // 在瀏覽器 Console 執行
   localStorage.setItem('drumstick-calibration', '你的JSON字串');
   // 重新載入頁面
   ```

## 🐛 疑難排解

### Q: 勾選後沒反應？

A: 檢查：
1. 感測器是否正常連線（左上角顯示「已連接」）
2. 是否有收到即時數據（數字在變化）
3. 重新整理頁面試試

### Q: 反轉後還是怪怪的？

A: 可能需要調整偏移量：
1. 先用反轉修正方向
2. 再用滑桿微調偏移
3. 也可以用 🎯 自動校準

### Q: 儲存後下次沒載入？

A: 可能原因：
1. 清除了瀏覽器 Cookie/快取
2. 使用了無痕模式
3. 換了瀏覽器

解決：重新設定並再次儲存

---

**版本**: 1.0  
**日期**: 2025-12-02  
**功能**: 軸方向反轉  
**作者**: Eleanor
