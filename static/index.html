<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Drum Splitter Demo</title>
    <style>
      body { font-family: Arial, Helvetica, sans-serif; max-width: 900px; margin: 2rem auto; }
      input[type=text] { width: 100%; padding: .5rem; font-size: 1rem }
      button { padding: .6rem 1rem; font-size: 1rem; margin-top: .5rem }
      .log { margin-top: 1rem; white-space: pre-wrap; background:#f7f7f7; padding: .5rem; border-radius:6px }
      .players { margin-top: 1rem }
    </style>
  </head>
  <body>
    <h2>簡易 Drum Splitter（Spleeter）示範</h2>
    <p>貼上 YouTube 連結，按下「開始分離」。伺服器會下載音訊並用 Spleeter 分離出鼓聲。</p>

    <label for="url">YouTube 連結：</label>
    <input id="url" type="text" placeholder="https://www.youtube.com/watch?v=..." />
    <div style="margin-top:.5rem">
      <label for="cookies_from_browser">Cookies from browser (optional):</label>
      <input id="cookies_from_browser" type="text" placeholder="chrome or edge or firefox" />
    </div>
    <div style="margin-top:.5rem">
      <label for="cookies_file">或上傳 cookies.txt（選擇性）：</label>
      <input id="cookies_file" type="file" accept="text/plain" />
    </div>
    <button id="start">開始分離</button>

    <div class="log" id="log">狀態：等待輸入</div>

    <div class="players" id="players"></div>

    <script>
      const log = (t)=>{ document.getElementById('log').textContent = t }
      document.getElementById('start').addEventListener('click', async ()=>{
        const url = document.getElementById('url').value.trim()
        if(!url){ alert('請輸入 YouTube 連結'); return }
        const cookiesFromBrowser = document.getElementById('cookies_from_browser').value.trim()
        const cookiesFile = document.getElementById('cookies_file').files[0]
        log('開始：向伺服器發出分離請求...')

        let res, j
        if (cookiesFile) {
          // send multipart form-data with file
          const fd = new FormData()
          fd.append('url', url)
          if (cookiesFromBrowser) fd.append('cookies_from_browser', cookiesFromBrowser)
          fd.append('cookies', cookiesFile)
          res = await fetch('/separate', { method:'POST', body: fd })
          j = await res.json()
        } else {
          // send JSON
          const payload = { url }
          if (cookiesFromBrowser) payload.cookies_from_browser = cookiesFromBrowser
          res = await fetch('/separate', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(payload) })
          j = await res.json()
        }
  if(!j.ok){ log('錯誤：' + (j.error||JSON.stringify(j))) ; return }
        log('完成：取得 stems，job_id=' + j.job_id)
        const players = document.getElementById('players')
        players.innerHTML = ''
        for(const [k,v] of Object.entries(j.stems)){
          const d = document.createElement('div')
          d.innerHTML = `<strong>${k}</strong><br><audio controls src="${v}"></audio>`
          players.appendChild(d)
        }
      })
    </script>
  </body>
</html>
